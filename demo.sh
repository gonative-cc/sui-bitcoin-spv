#!/bin/bash

# a trusted header
# regtest snapshot
INIT_HEADERS='[0x0100000000000000000000000000000000000000000000000000000000000000000000003ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4adae5494dffff7f2002000000,0x0000002006226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f52fd125cf8c121b7208b1b0bd6f08b7879a2c16ff3a157c542212b711f00f65a23f53968ffff7f2000000000,0x0000002030c1c80a378913115da2f0b1be33647b464b70f6ac3c9cab44928a048b6a2b5fb4ff6a9821d3783415f5c8847a04734d9c112c498f61ff109c1570d5aa0fa36d24f53968ffff7f2000000000,0x0000002087cb67dcf8923d7cbd81364f6a084f2d455c79b1a668a0042ed8389e5a158a32392ff101ac64bd646624d6868ba1fa879f81d0d9134d250d8549d39caef1e50224f53968ffff7f2001000000,0x00000020259f7a0dd8ce4745df47c49468729ec0a05d08ac59d74f721cfbe3036e53a351f0a872a5a1964889682b1992676623869e01f0e3ecca4ba5b8bb55f3283b63a925f53968ffff7f2000000000,0x00000020097890f6fc4dac27c557a6063900476e3e7e40a0887d5a8305855c5416962e4d129a51f4da655ee5d06b43761c11b1ef1f7b0d52d5d2166058a38f3bd5394ede25f53968ffff7f2002000000,0x00000020d4364143fa2653db7aa808fe02f4d28446c5b2a55e5d86c1cfe3a8682f321950aacbbbb4b29458d0794403aa474d3bf915445d3cce5b23ca7665206c75b1e04625f53968ffff7f2001000000,0x00000020a8400dbd919e20298daef3bfaeed9fcda9ab0c17196d1774e1242c58eeaa786c72a436186b6017c4052fc2364c1ac63787798fa5c5b9e42282e1adda1d8c46b525f53968ffff7f2003000000,0x00000020cfb4b49fd6bbb38489fbaf2305476c47298cbc93bd0a7834c09b664e337034197084bd886eedcb112757fa576d8bc71733dc30f35030fc6e790e4bc848ef9cfc26f53968ffff7f2000000000,0x0000002086c67db134575349c9ca837538f6e4ad2cbcee2646cb25daed1a323fa1294a27b35ba4baa79bc7f8f46c0a3b74109800b35b3f30b828522e0a0c03cff2b10ca926f53968ffff7f2000000000,0x000000201003dc3bf4cd3ad01a696c41327878eac8ab7ac57424485173fd2f10ea583c74d2ce3b38bfd3927ab4f210f5884f9f3fe73f6b37fbb2ea3da6d88c2331fdb9ff26f53968ffff7f2000000000,0x00000020042e8c9f42234b7b7c023019883a4b7fa16d11a0dc5aaa1d718214d5974e0e5f68ad39562e3887f0df4ecd796e337cfdd5b040d819088490f63e9e615dff0f0226f53968ffff7f2001000000]'

# a list of header follow a init header
HEADERS_FOR_INSERT='[0x00000030e98bb046cd25a629c91f0c7623cc2ed0c12ef6db5e41956536c261eb673d0b0f813b60988eadd1961289bf5f2098f6ca0c7dd35ae95e78807c6582a46e00107f39c5b167ffff7f2004000000,0x000000304f58550f49b5c9dce6328bc8d7b8f5941823efcc51741a024c17d9745ba21111cb2db51b4bf0858c2318820adafa1c8640703dca1faceea0205f388f160d452539c5b167ffff7f2004000000,0x00000030aa8bd6ce82edf1f9c03abc2243281f622594bc3aec5106a17f612371f76060084e05aaf29bda3424553cb4636006d006030690b91875fe96fdb4c52d4a38ba8a39c5b167ffff7f2003000000]'

# a list of header this create fork, and more powerful than current chain
HEADERS_FOR_FORK='[0x000000307306011c31d1f14a422c50c70cbedb1233757505cb887d82d51ae3f27e23062d6be46c161e69696c1c83ba3a1ea52f071fcdada5a6bce28f5da591b969b42da19dc5b167ffff7f2001000000,0x000000302ba076eb907ec3c060954d36dfcf0e735c815c9531f6d44667aa32f5999f412d813b60988eadd1961289bf5f2098f6ca0c7dd35ae95e78807c6582a46e00107f9dc5b167ffff7f2001000000,0x00000030525bda2756ff6f9e440c91590490462ac33e0fedb05b1558cfd3f7ce90920d16cb2db51b4bf0858c2318820adafa1c8640703dca1faceea0205f388f160d45259dc5b167ffff7f2002000000,0x000000306052592f4f0e4886a0eca2c1d154e8b9761e011b4f7b3a00908e2a830f7f6c6a4e05aaf29bda3424553cb4636006d006030690b91875fe96fdb4c52d4a38ba8a9dc5b167ffff7f2001000000,0x000000309c32ae8f3b099ea17563bb425476cf962b84269e09d17e19350b819695970f2cdebd5d70e4be4f6f5cc474416137a697f1fca22bf87e9066eb9b43dd7882d2329dc5b167ffff7f2001000000,0x000000307370f207ef4945a89b10b1c60a14770136109de093df4544340251190a5c2436494bba4bf2f3dc3a1d8c1bb592eeadc16c77b6bdd42c6ad2003a704641c3caeb9dc5b167ffff7f2000000000,0x000000305e52d670c3efd5ff9152b325f6cf2c59154b856215a99c8101efc51688937e734ca6a58af04afaa3eea3d8c6fa6c29eb0454a7e18d5953a1766ab994152f5f169ec5b167ffff7f2005000000,0x00000030e61a86ad71115af58d3e2ab5280a4423920b5311094403376b563b2fc09e9843240a1d2cf05759689835b13573161887f2c284aece535a39642db5d5bf2588e59ec5b167ffff7f2002000000]'

BTC_NETWORK=2 # 0 = mainnet, 1 = testnet, otherwise = regtest

PACKAGE_ID="0x9e4f5db3c4d75e312c9360c21a454a8555e706431ea9eef14f5898238deec7a5"

# Create a new light client
function create_light_client() {
    sui client call --function init_light_client_network --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $BTC_NETWORK 0 $INIT_HEADERS 0
}

# get object SPV
# You can use sui explored for more information
function client_object() {
    LC_ID=$1
    sui client object $LC_ID
}

# Insert a new headers
function insert_headers() {
    echo "We extend a current chain"
    echo $HEADERS_FOR_INSERT
    LC_ID=$1
    sui client call --function insert_headers --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $LC_ID $HEADERS_FOR_INSERT
}

# Insert a new headers with fork potential
function insert_headers_fork_potential() {
    echo "We insert a list header can create fork"
    echo $HEADERS_FOR_FORK
    LC_ID=$1
    sui client call --function insert_headers --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $LC_ID $HEADERS_FOR_FORK
}

# Get last block
function head() {
    LC_ID=$1
    sui client call --function head --module light_client --package $PACKAGE_ID --gas-budget 10000000 --args $LC_ID --dev-inspect
}

case "$1" in
create_lc)
    create_light_client
    ;;
insert_headers)
    insert_headers $2
    ;;
insert_headers_fork)
    insert_headers_fork_potential $2
    ;;
head)
    head $2
    ;;
lc_object)
    client_object $2
    ;;
*)
    echo "Invalid option."
    exit 1
    ;;
esac
