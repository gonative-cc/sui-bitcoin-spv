#!/bin/bash

# a trusted header
# regtest snapshot
INIT_HEADERS='[0x00c042223565851686cae7b1055470b350da93da070a90176d072a28ee708606000000000f16b04095b366ac3c01c4249a4497a697142c2cf68a777cf838417783b9a48949ac8068fbf803198ae6d6bd,0x00000020dee2de0468eb4968438c8e6bd465dcc115cd88e03fbac2020100000000000000d555aa42f7b8906fc3488202a4741f17d79200eecf3eb755e63f491fc4a40d2d7ac08068ffff001d8989953f,0x000000205862f5acb45556082a250a5997f5d68fff435288d579bf19f29bf002000000002ce61a1a2c142f8750cce845c0dc1e57127ebf81a1d972c5a20a4685a69e6eab2bc58068ffff001dc7de10f1,0x000000206c86631b8d780bfd395ab5b7039710699eed43e43b3e0bbc944daf0100000000c0ef85d17cf738f82f7b4c4221bc03641ab8a759820febce0c17c4cc4c7ea98adcc98068ffff001d027cd5cd,0x00000020afa079bcc4fe3a3dda103d9fcbf71cbcd795ae86b555cc30ecb9ee03000000004de897466b9f59cfc8b56d50fad61344b35ebcf0f0396f4e717112edd5035e1b8dce8068ffff001dc025dcd8,0x000000201567978264de12c5e9a940fdfcc8bde2b39bdbf8e688e80e760d9d07000000002298ac552eb0871223abe94d4b47d2a546d3f040a1bfb93566855631ef8587233ed38068ffff001dba92cb6a,0x00000020427a0053e80956351ce51f2f122e25b1385b3e09b1ed04c84c633b0000000000706172cff5d58390c1ebe4b85b291bcd0fc8a35868327ee8147e5948aff30abbefd78068ffff001d0c28905c,0x000000201d0e31f722f0815f7e88d72099a01cd751c452825428da62b8fef6aa000000009e8b9d72b1df8756b0cbfd328246f776d972c98beec952f3e910ae886a88dfd4a0dc8068ffff001d3b31943c,0x000000205f26236633b62911fc508b6f990779d4005ba2f4d85cc62c4de521660000000084f3f61cd8a73e3b664fe2857e1642d4d1dc2c6dbb92c1fba8a4e4a10bb73e2d51e18068ffff001d02d8a9d6,0x00c05a23589ad4f28b61a30c2cd87dec5c6fd0cf7c28782288724d90697adccf0000000046332fadc148a1cc076a7feabd64ddc5b5ff0200c3c05cdc3f8b769dddcc746c53ca8068fbf80319340d3418,0x00a05121b51861fbf7d28ac7ffe78b977444ca83d1482b7776809e9b010000000000000007e73565602af70f0a7dbd01c3ea8b73919adc66a61064f3eaaa13537df556cf04cf8068ffff001d1c012458,0x00a0e820d4e1f61e443aed268c9d5254ed22973b1c8f820dbdb19406bf2d8100000000000bbf56c73ba35423ed1359ec9da757293d767557e98a11dadf572309b559bd34b5d38068ffff001dee0307fa]'

# a list of header follow a init header
HEADERS_FOR_INSERT='[0x00000030e98bb046cd25a629c91f0c7623cc2ed0c12ef6db5e41956536c261eb673d0b0f813b60988eadd1961289bf5f2098f6ca0c7dd35ae95e78807c6582a46e00107f39c5b167ffff7f2004000000,0x000000304f58550f49b5c9dce6328bc8d7b8f5941823efcc51741a024c17d9745ba21111cb2db51b4bf0858c2318820adafa1c8640703dca1faceea0205f388f160d452539c5b167ffff7f2004000000,0x00000030aa8bd6ce82edf1f9c03abc2243281f622594bc3aec5106a17f612371f76060084e05aaf29bda3424553cb4636006d006030690b91875fe96fdb4c52d4a38ba8a39c5b167ffff7f2003000000]'

# a list of header this create fork, and more powerful than current chain
HEADERS_FOR_FORK='[0x000000307306011c31d1f14a422c50c70cbedb1233757505cb887d82d51ae3f27e23062d6be46c161e69696c1c83ba3a1ea52f071fcdada5a6bce28f5da591b969b42da19dc5b167ffff7f2001000000,0x000000302ba076eb907ec3c060954d36dfcf0e735c815c9531f6d44667aa32f5999f412d813b60988eadd1961289bf5f2098f6ca0c7dd35ae95e78807c6582a46e00107f9dc5b167ffff7f2001000000,0x00000030525bda2756ff6f9e440c91590490462ac33e0fedb05b1558cfd3f7ce90920d16cb2db51b4bf0858c2318820adafa1c8640703dca1faceea0205f388f160d45259dc5b167ffff7f2002000000,0x000000306052592f4f0e4886a0eca2c1d154e8b9761e011b4f7b3a00908e2a830f7f6c6a4e05aaf29bda3424553cb4636006d006030690b91875fe96fdb4c52d4a38ba8a9dc5b167ffff7f2001000000,0x000000309c32ae8f3b099ea17563bb425476cf962b84269e09d17e19350b819695970f2cdebd5d70e4be4f6f5cc474416137a697f1fca22bf87e9066eb9b43dd7882d2329dc5b167ffff7f2001000000,0x000000307370f207ef4945a89b10b1c60a14770136109de093df4544340251190a5c2436494bba4bf2f3dc3a1d8c1bb592eeadc16c77b6bdd42c6ad2003a704641c3caeb9dc5b167ffff7f2000000000,0x000000305e52d670c3efd5ff9152b325f6cf2c59154b856215a99c8101efc51688937e734ca6a58af04afaa3eea3d8c6fa6c29eb0454a7e18d5953a1766ab994152f5f169ec5b167ffff7f2005000000,0x00000030e61a86ad71115af58d3e2ab5280a4423920b5311094403376b563b2fc09e9843240a1d2cf05759689835b13573161887f2c284aece535a39642db5d5bf2588e59ec5b167ffff7f2002000000]'

BTC_NETWORK=1 # 0 = mainnet, 1 = testnet, otherwise = regtest

PACKAGE_ID="0x605979075d8f71d1338888c08ae37239c25bb8d5e955d6ebc15f906076c65683"

START_HEIGHT=92736 # height of the first header passed to init function

# Create a new light client
function create_light_client() {
    sui client call --function init_light_client_network --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $BTC_NETWORK $START_HEIGHT $INIT_HEADERS 0
}

# get object SPV
# You can use sui explored for more information
function client_object() {
    LC_ID=$1
    sui client object $LC_ID
}

# Insert a new headers
function insert_headers() {
    echo "We extend a current chain"
    echo $HEADERS_FOR_INSERT
    LC_ID=$1
    sui client call --function insert_headers --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $LC_ID $HEADERS_FOR_INSERT
}

# Insert a new headers with fork potential
function insert_headers_fork_potential() {
    echo "We insert a list header can create fork"
    echo $HEADERS_FOR_FORK
    LC_ID=$1
    sui client call --function insert_headers --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $LC_ID $HEADERS_FOR_FORK
}

# Get last block
function head() {
    LC_ID=$1
    sui client call --function head --module light_client --package $PACKAGE_ID --gas-budget 10000000 --args $LC_ID --dev-inspect
}

case "$1" in
create_lc)
    create_light_client
    ;;
insert_headers)
    insert_headers $2
    ;;
insert_headers_fork)
    insert_headers_fork_potential $2
    ;;
head)
    head $2
    ;;
lc_object)
    client_object $2
    ;;
*)
    echo "Invalid option."
    exit 1
    ;;
esac
